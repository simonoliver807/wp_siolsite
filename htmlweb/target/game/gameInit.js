define(["game/oimo","game/v3d"],function(o,e){"use strict";return function(){var t,n,r,a,i,s,p,m=[],c=0,d=0,l=new e.View,f=2,h=8,u=!1,g=(new o.Vec3(0,0,0),[]),v=0;new o.Vec3(0,0,100),new o.Vec3(0,0,-100),new o.Vec3(0,1,0),l.w/2,l.h/2;p=new o.Vec3(0,0,0);document.getElementById("container");return{createWorld:function(e){t=new o.World(e,f,h,u),t.worldscale(100),t.gravity=new o.Vec3(0,0,0)},oimoLoop:function(){if(!d){t.step();for(var o,e,n=g.length;n--;)if(e=g[n],o=m[n],!e.getSleep()){if(o.position.copy(e.getPosition()),o.quaternion.copy(e.getQuaternion()),"shp1"==e.name){p.copy(r.position),r.position.copy(e.getPosition());var a=r.position.x-p.x,s=r.position.y-p.y,c=r.position.z-p.z;l.camera.position.x+=a,l.camera.position.y+=s,l.camera.position.z+=c,l.startRot.rot&&(l.log("rot started cam","oimoLoop"),l.camera.position.x+=l.camrot.x,l.camera.position.y+=l.camrot.y,l.camera.position.z+=l.camrot.z,l.camera.lookAt(r.position)),i.position.x+=a,i.position.y+=s,i.position.z+=c,l.startRot.rot&&(l.log("rot started","proBox"),i.position.x+=l.pbrot.x,i.position.y+=l.pbrot.y,i.position.z+=l.pbrot.z,i.lookAt(r.position))}"sbox"===o.material.name&&(o.material=l.mats.box),"ssph"===o.material.name&&(o.material=l.mats.sph)}}},populate:function(e){var r;n=new o.Performance(t);var a,s,p,d,f,h,u;a=500,p=-1500,s=100,d=.5,f=.5,h=.5;var w=[{size:[7.5,7.5,7.5],pos:[0,1,0],move:"true",name:"shp1",color:"#66ff33",image:"shp1.jpg"},{size:[2,2,2],pos:[0,0,-100],move:"true",name:"sight",color:"#ff00ff"},{size:[2,2,2],pos:[0,1,0],move:"true",name:"containerSphere",color:"#ff0000"},{size:[500,500,500],pos:[500,10,-5e3],move:"true",name:"planet",color:"#0000ff",image:"planet_1.png"}];this.addSphere(w);var y=l.whcam();i={type:"transbox",size:[y.w,y.h,.5],pos:[0,0,-100],move:!0,world:t,name:"proBox"},m[c]=l.add(i),i=m[c];for(var x=0;x<e;x++){var u=2;2===u&&(r={type:"box",size:[d,f,h],pos:[a,s,p],move:!0,world:t,name:"box1"}),3===u&&(r={type:"cylinder",size:[d,f,d,d,f,d,d,f,d,d,f,d],pos:[a,s,p],rot:[0,0,0,0,45,0,0,22.5,0,0,-22.5,0],move:!0,world:t}),g[v]=new o.Body(r),m[c]=l.add(r),v+=1,c+=1,a=this.randMinMax(-5e3,5e3),s=this.randMinMax(-5e3,5e3),p=this.randMinMax(-5e3,5e3)}},addSphere:function(e){var n;for(var i in e){var p={type:"sphere",size:e[i].size,pos:e[i].pos,move:e[i].move,world:t,name:e[i].name,color:e[i].color,image:e[i].image};if("containerSphere"!=p.name&&"sight"!=p.name&&(g[v]=new o.Body(p),m[c]=l.add(p,n,p.color,p.image),"planet"==p.name&&(s=m[c]),v+=1,c+=1,"shoot"==p.name))return g[v-1];"containerSphere"==p.name&&(r=l.add(p,n,p.color)),"sight"==p.name&&(a=l.add(p,n,p.color))}},getObj:function(o){switch(o){case"bodys":return g;case"containerMesh":return r;case"v3d":return l;case"world":return t}},randMinMax:function(o,e){return Math.floor(Math.random()*(e-o+1))+o},isSleeping:function(o){for(var e=0;e<g.length;e++)if(g[e].name==o)return g[e].getSleep()}}}});