define(["game/gameinit","game/v3d"],function(e,t){"use strict";return function(){var a,i,o=new e,n=document.getElementById("container"),s=1/60,r={LEFT:37,UP:38,RIGHT:39,BOTTOM:40,ECS:27,SPC:32},l=0;return{init:function(){i=o.getObj("v3d"),this.loadEvents(),o.createWorld(s),o.populate(1e3),i.initLight(),a=this.render,this.render(),setInterval(o.oimoLoop,1e3*s)},render:function(){requestAnimationFrame(a),l||i.render()},handleKeyDown:function(e){e.preventDefault(),e.stopPropagation();var t=o.getObj("bodys"),a=o.getObj("containerMesh"),n=o.getObj("world");switch(e.keyCode){case r.UP:i.log("cam but push: ",i.camera.position);var s=i.getPlayerDir("forward",a.position);s.x*=50,s.y*=50,s.z*=50;var c=t[0].body;c.linearVelocity.addTime(s,n.timeStep),console.log("heading x: "+c.linearVelocity.x+" heading y: "+c.linearVelocity.y+"heading z: "+c.linearVelocity.z);break;case r.BOTTOM:var s=i.getPlayerDir("reverse",a.position);s.x*=50,s.y*=50,s.z*=50;var c=t[0].body;c.linearVelocity.addTime(s,n.timeStep);break;case r.LEFT:break;case r.RIGHT:i.applyRot();break;case r.SPC:var s=i.getPlayerDir("forward",a,sightMesh);s.x*=500,s.y*=500,s.z*=500;var d=a.position,g=[{size:[1.5,1.5,1.5],pos:[d.x,d.y,d.z-1],move:"true",name:"shoot",color:"#66ff33"}],m=addSphere(g);m.body.linearVelocity.addTime(s,n.timeStep);break;case r.ECS:l=1===l?0:1}},handleMouseMove:function(e){var a=i.container.children[0],n=a.getBoundingClientRect(),s=e.clientX-n.left,r=e.clientY-n.top;t.msePos.x=s/i.w*2-1,t.msePos.y=2*-(r/i.h)+1;var l=o.isSleeping("shp1"),c=i.w/100*10,d=i.h/100*10,g=i.w-c,m=c,y=i.h-d,h=d;s>g?(i.startRot.axis.set(0,1,0),i.startRot={issleeping:l,rot:1,camAngle:i.camAngle,axis:i.startRot.axis}):s<m?(i.startRot.axis.set(0,1,0),i.startRot={issleeping:l,rot:1,camAngle:i.camAngle*-1,axis:i.startRot.axis}):r>y?(i.startRot.axis.set(1,0,0),i.startRot={issleeping:l,rot:1,camAngle:i.camAngle,axis:i.startRot.axis}):r<h?(i.startRot.axis.set(1,0,0),i.startRot={issleeping:l,rot:1,camAngle:i.camAngle*-1,axis:i.startRot.axis}):i.startRot={issleeping:l,rot:0,camAngle:i.camAngle,axis:i.startRot.axis}},loadEvents:function(){window.addEventListener("keydown",this.handleKeyDown,!1),window.scrollTo(0,document.body.clientHeight),n.addEventListener("mousemove",this.handleMouseMove,!1)}}}});