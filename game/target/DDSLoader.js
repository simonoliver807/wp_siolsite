define(["three"],function(r){r.DDSLoader=function(){this._parser=r.DDSLoader.parse},r.DDSLoader.prototype=Object.create(r.CompressedTextureLoader.prototype),r.DDSLoader.prototype.constructor=r.DDSLoader,r.DDSLoader.parse=function(a,e){function t(r){return r.charCodeAt(0)+(r.charCodeAt(1)<<8)+(r.charCodeAt(2)<<16)+(r.charCodeAt(3)<<24)}function o(r){return String.fromCharCode(255&r,r>>8&255,r>>16&255,r>>24&255)}function n(r,a,e,t){for(var o=e*t*4,n=new Uint8Array(r,a,o),i=new Uint8Array(o),m=0,p=0,u=0;u<t;u++)for(var s=0;s<e;s++){var c=n[p];p++;var d=n[p];p++;var h=n[p];p++;var D=n[p];p++,i[m]=h,m++,i[m]=d,m++,i[m]=c,m++,i[m]=D,m++}return i}var i={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},m=542327876,p=131072,u=512,s=1024,c=2048,d=4096,h=8192,D=16384,f=32768,C=4,T=t("DXT1"),v=t("DXT3"),S=t("DXT5"),_=t("ETC1"),l=31,A=0,L=1,b=2,E=3,w=4,R=7,g=20,y=21,F=22,x=23,X=24,B=25,G=26,M=28,U=new Int32Array(a,0,l);if(U[A]!==m)return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),i;if(!U[g]&C)return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),i;var k,H=U[y],I=!1;switch(H){case T:k=8,i.format=r.RGB_S3TC_DXT1_Format;break;case v:k=16,i.format=r.RGBA_S3TC_DXT3_Format;break;case S:k=16,i.format=r.RGBA_S3TC_DXT5_Format;break;case _:k=8,i.format=r.RGB_ETC1_Format;break;default:if(!(32===U[F]&&16711680&U[x]&&65280&U[X]&&255&U[B]&&4278190080&U[G]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",o(H)),i;I=!0,k=64,i.format=r.RGBAFormat}i.mipmapCount=1,U[b]&p&&e!==!1&&(i.mipmapCount=Math.max(1,U[R]));var j=U[M];if(i.isCubemap=!!(j&u),i.isCubemap&&(!(j&s)||!(j&c)||!(j&d)||!(j&h)||!(j&D)||!(j&f)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),i;i.width=U[w],i.height=U[E];for(var O=U[L]+4,q=i.isCubemap?6:1,z=0;z<q;z++)for(var J=i.width,K=i.height,N=0;N<i.mipmapCount;N++){if(I)var P=n(a,O,J,K),Q=P.length;else var Q=Math.max(4,J)/4*Math.max(4,K)/4*k,P=new Uint8Array(a,O,Q);var V={data:P,width:J,height:K};i.mipmaps.push(V),O+=Q,J=Math.max(J>>1,1),K=Math.max(K>>1,1)}return i}});