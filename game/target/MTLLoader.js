define(["three"],function(t){t.MTLLoader=function(a){this.manager=void 0!==a?a:t.DefaultLoadingManager},Object.assign(t.MTLLoader.prototype,t.EventDispatcher.prototype,{load:function(a,e,r,s){var i=this,o=new t.XHRLoader(this.manager);o.setPath(this.path),o.load(a,function(t){e(i.parse(t))},r,s)},setPath:function(t){this.path=t},setTexturePath:function(t){this.texturePath=t},setBaseUrl:function(t){console.warn("THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead."),this.setTexturePath(t)},setCrossOrigin:function(t){this.crossOrigin=t},setMaterialOptions:function(t){this.materialOptions=t},parse:function(a){for(var e=a.split("\n"),r={},s=/\s+/,i={},o=0;o<e.length;o++){var n=e[o];if(n=n.trim(),0!==n.length&&"#"!==n.charAt(0)){var h=n.indexOf(" "),p=h>=0?n.substring(0,h):n;p=p.toLowerCase();var l=h>=0?n.substring(h+1):"";if(l=l.trim(),"newmtl"===p)r={name:l},i[l]=r;else if(r)if("ka"===p||"kd"===p||"ks"===p){var c=l.split(s,3);r[p]=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])]}else r[p]=l}}var u=new t.MTLLoader.MaterialCreator(this.texturePath||this.path,this.materialOptions);return u.setCrossOrigin(this.crossOrigin),u.setManager(this.manager),u.setMaterials(i),u}}),t.MTLLoader.MaterialCreator=function(a,e){this.baseUrl=a||"",this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:t.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:t.RepeatWrapping},t.MTLLoader.MaterialCreator.prototype={constructor:t.MTLLoader.MaterialCreator,setCrossOrigin:function(t){this.crossOrigin=t},setManager:function(t){this.manager=t},setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var a={};for(var e in t){var r=t[e],s={};a[e]=s;for(var i in r){var o=!0,n=r[i],h=i.toLowerCase();switch(h){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(n=[n[0]/255,n[1]/255,n[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===n[0]&&0===n[1]&&0===n[2]&&(o=!1)}o&&(s[h]=n)}}return a},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var a in this.materialsInfo)this.materialsArray[t]=this.create(a),this.nameLookup[a]=t,t++;return this.materialsArray},create:function(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(a){function e(t,a){if(!i[t]){var e=r.getTextureParams(a,i),s=r.loadTexture(o(r.baseUrl,e.url));s.repeat.copy(e.scale),s.offset.copy(e.offset),s.wrapS=r.wrap,s.wrapT=r.wrap,i[t]=s}}var r=this,s=this.materialsInfo[a],i={name:a,side:this.side},o=function(t,a){return"string"!=typeof a||""===a?"":/^https?:\/\//i.test(a)?a:t+a};for(var n in s){var h=s[n];if(""!==h)switch(n.toLowerCase()){case"kd":i.color=(new t.Color).fromArray(h);break;case"ks":i.specular=(new t.Color).fromArray(h);break;case"map_kd":e("map",h);break;case"map_ks":e("specularMap",h);break;case"map_bump":case"bump":e("bumpMap",h);break;case"ns":i.shininess=parseFloat(h);break;case"d":h<1&&(i.opacity=h,i.transparent=!0);break;case"Tr":h>0&&(i.opacity=1-h,i.transparent=!0)}}return this.materials[a]=new t.MeshPhongMaterial(i),this.materials[a]},getTextureParams:function(a,e){var r,s={scale:new t.Vector2(1,1),offset:new t.Vector2(0,0)},i=a.split(/\s+/);return r=i.indexOf("-bm"),r>=0&&(e.bumpScale=parseFloat(i[r+1]),i.splice(r,2)),r=i.indexOf("-s"),r>=0&&(s.scale.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),r=i.indexOf("-o"),r>=0&&(s.offset.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),s.url=i.join(" ").trim(),s},loadTexture:function(a,e,r,s,i){var o,n=t.Loader.Handlers.get(a),h=void 0!==this.manager?this.manager:t.DefaultLoadingManager;return null===n&&(n=new t.TextureLoader(h)),n.setCrossOrigin&&n.setCrossOrigin(this.crossOrigin),o=n.load(a,r,s,i),void 0!==e&&(o.mapping=e),o}}});